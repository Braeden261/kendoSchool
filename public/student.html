<html>
    <head>
        <title>Kendo School</title>
        <script src="/js/aframe-v0.8.2.min.js"></script>
        <script src="/js/aframe-physics-system.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="/js/hit-sound-component.js"></script>
    </head>
    <body>
        <a-scene physics="debug: false; maxInterval: 0.01; iterations: 20; restitution: 0.1" shadow="type: pcfsoft;" fog="type: linear; color: #e0bfb6; near: 5.8; far: 45.88;">
      
            <a-assets>
                <!-- Textures -->
                <img id = "skymap" src = "/assets/textures/skyTexture/sky-02.png">
                <img id = "dojo-tex" src = "/assets/textures/dojoTexture/dojo_wallsFloors_texture-02.png">
                <img id = "lantern-tex" src = "/assets/textures/lanternTexture/lantern_tex.png">

                <!-- Models -->
                <a-asset-item id="dojo-obj" src="/assets/models/objFiles/dojo/dojo_structure.obj"></a-asset-item>
                <a-asset-item id="windows-obj" src="/assets/models/objFiles/dojo/dojo_windows.obj"></a-asset-item>
                <a-asset-item id="shinai-obj" src="/assets/models/proxyModels/proxyModels_obj/KendoGakko_Shinai_PROXY_v003.obj"></a-asset-item>
                <a-asset-item id="dummy-obj" src="/assets/models/proxyModels/proxyModels_obj/KendoGakko_Dummy_PROXY_v002.obj"></a-asset-item>
                <a-asset-item id="lanternFrames-obj" src="/assets/models/objFiles/lantern/lanterns_frames.obj"></a-asset-item>
                <a-asset-item id="lanternBodies-obj" src="/assets/models/objFiles/lantern/lantern_body.obj"></a-asset-item>

                <!-- Audio -->
                <audio id='hit-sound' src='/assets/sounds/effects/hitSound.mp3'></audio>
                <audio id="nature-sound" loop>
                    <source  src="/assets/sounds/ambientSounds.mp3" type="audio/mp3">
                </audio>
            </a-assets>
            <!--Sounds-->
            <a-entity id="hitSnd" sound="src:#hit-sound"></a-entity>

            <!-- VR hand-controls (FireFox Only) -->
            <a-entity   id="leftHand"
                        hand-controls="left"
            ></a-entity>

            <a-entity   id="rightHand"
                        hand-controls="right"
            >
                <a-entity   id="rhBox"
                            static-body
                            geometry="primitive: box; height: 1; width: 0.02; depth: 0.02"
                            material="color: #e74c3c; visible: true; wireframe: false"
                            position="-0.4 -0.02 0.02"
                            rotation="0 0 90"
                ></a-entity>
            </a-entity>


            <!-- CAMERA (User POV, 6ft tall person standing on raised platform) -->
            <a-entity camera look-controls position="0 2.2 1.05" ></a-entity>

            <!-- Ground Planes -->
            <a-plane static-body position="0 0.6 0" rotation="90 0 0" width="3.658" height="3.658"></a-plane>
            <a-plane static-body position="0 0 0" rotation="90 0 0" width="12.192" height="21.336"></a-plane>
            
            <!-- Lights -->
            <a-entity   light = "type: spot; intensity: 0.45; angle: 60; penumbra: 0.9; color: #fff8e8; castShadow: true; shadowBias: -0.000001; shadowMapWidth: 2048; shadowMapHeight: 2048;"
                        position = "0 7.33 0"
                        rotation = "-90 0 0"
            ></a-entity>
            <a-entity   light = "type: ambient; intensity: 0.15; color: #f86605;"></a-entity>
            <a-entity   light = "type: spot; angle: 25; penumbra: 1; color: #ffefca"
                        position = "0 4.95 -14.27"
                        rotation = "-90 0 0"
            ></a-entity>
            
            <!-- Models -->
            <a-entity   id="dojo"
                        obj-model="obj:#dojo-obj"
                        scale="1.0 1.0 1.0"
                        position="0 0 0"
                        material="src:#dojo-tex; roughness:0.7; metalness:0; transparent:true; opacity:1;"
                        shadow="cast:true; receive:true;"
            ></a-entity>

            <a-entity   id="windows"
                        obj-model="obj:#windows-obj"
                        scale="1.0 1.0 1.0"
                        position="0 0 0"
                        material="color:##fff9de; roughness:0.7; metalness:0; transparent:true; opacity:0.85;"
                        shadow="cast:true; receive:true;"
            ></a-entity>

            <a-entity   id="lantern-frames"
                        obj-model="obj:#lanternFrames-obj"
                        scale="1.0 1.0 1.0"
                        position="0 0 0"
                        material="src:#lantern-tex; roughness:0.7; metalness:0; transparent:true; opacity:1;"
                        shadow="cast:true; receive:true;"
            ></a-entity>

            <a-entity   id="lantern-bodies"
                        obj-model="obj:#lanternBodies-obj"
                        scale="1.0 1.0 1.0"
                        position="-4.915 2.510 -9.993"
                        material="src:#lantern-tex; roughness:0.7; metalness:0; transparent:true; opacity:0.1;"
                        shadow="cast:true; receive:true;"
                        light="type:point; intensity:0.3; color:#ffefca;"
            ></a-entity>
            
            <a-entity   id="dummyBox"
                        physics="restitution: 0;"
                        static-body
                        geometry="primitive:box; height:1.7; width:0.45; depth:0.45;"
                        position="0 1.45 -1.0"
                        material="color:#FFFFFF; visible:false; wireframe:true;">
                <a-entity   id="dummy"
                            obj-model="obj:#dummy-obj"
                            position="0 -0.85 -0.21"
                            scale="1.0 1.0 1.0"
                            rotation="0 90 0"
                            material="color:#bdc3c7; roughness:0.7; metalness:0;"
                ></a-entity>
            </a-entity>
            
            <a-entity hit-sound-component
                        id="shinaiBox"
                        dynamic-body
                        geometry="primitive:cylinder; height:1.42; radius:0.05; segmentsRadial: 12; segmentsHeight:1;"
                        position="0 2 0.250"
                        rotation="0 0 -90"
                        material="color:#FFFFFF; visible:false; wireframe:true;">>
                <a-entity   id="shinai"
                            obj-model="obj:#shinai-obj"
                            scale="1.0 1.0 1.0"
                            position="0.754 -0.70 0"
                            rotation="0 0 0"
                            material="color:#bdc3c7; roughness:0.7; metalness:0;"
                ></a-entity>
            </a-entity>

            <!-- Sky Dome -->
            <a-entity   id = "sky"
                        geometry = "primitive: sphere; radius: 500;"
                        material = "shader: flat; src: #skymap; side: back; height: 2048; width: 2048; fog: false;"
            ></a-entity>
            
       </a-scene>


       <script>
            //Write some socket client code
            let socket = io();

            socket.on('connect', function(userData){
                console.log('connected');
            });

            socket.on('send_instruction', function(data){
                console.log('Sequence: ' + data.sequence); //print data in console
            });

            window.onload = function(){
                let ambient = document.querySelector('#nature-sound');
                ambient.volume = 0.05;
                ambient.play();
            }

            
            
        </script>

    </body>
</html>